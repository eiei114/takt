name: roblox-studio
description: Roblox TS piece with Studio MCP verification (plan -> implement -> verify -> parallel review -> fix -> complete)
piece_config:
  provider_options:
    codex:
      network_access: true
    opencode:
      network_access: true
max_movements: 25
initial_movement: plan
movements:
  - name: plan
    edit: false
    persona: planner
    knowledge:
      - roblox-ts
      - studio-mcp
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Bash
      - WebSearch
      - WebFetch
      - mcp__robloxstudio-mcp__get_studio_mode
      - mcp__robloxstudio-mcp__run_code
      - mcp__roblox-docs__roblox_search
      - mcp__roblox-docs__roblox_get_class
      - mcp__roblox-docs__roblox_get_member
      - mcp__roblox-docs__roblox_get_enum
      - mcp__roblox-docs__roblox_list_services
    rules:
      - condition: Requirements are clear and implementation is possible
        next: implement
      - condition: User is asking a question (not an implementation task)
        next: COMPLETE
      - condition: Requirements are unclear, insufficient information
        next: ABORT
    instruction: plan
    output_contracts:
      report:
        - name: 00-plan.md
          format: plan

  - name: implement
    edit: true
    persona: roblox-coder
    policy:
      - roblox-coding
      - coding
    session: refresh
    knowledge:
      - roblox-ts
      - flamework
      - studio-mcp
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
      - mcp__robloxstudio-mcp__run_code
      - mcp__robloxstudio-mcp__get_console_output
      - mcp__robloxstudio-mcp__get_studio_mode
      - mcp__robloxstudio-mcp__insert_model
      - mcp__roblox-docs__roblox_search
      - mcp__roblox-docs__roblox_get_class
      - mcp__roblox-docs__roblox_get_member
      - mcp__roblox-docs__roblox_get_enum
      - mcp__roblox-docs__roblox_search_devforum
    required_permission_mode: edit
    instruction: implement
    rules:
      - condition: Implementation complete
        next: verify
      - condition: Cannot proceed, insufficient info
        next: ABORT
      - condition: User input required because there are items to confirm with the user
        next: implement
        requires_user_input: true
        interactive_only: true
    output_contracts:
      report:
        - name: coder-scope.md
          format: coder-scope
        - name: coder-decisions.md
          format: coder-decisions

  - name: verify
    edit: false
    persona: supervisor
    knowledge:
      - roblox-ts
      - studio-mcp
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Bash
      - mcp__robloxstudio-mcp__run_code
      - mcp__robloxstudio-mcp__get_console_output
      - mcp__robloxstudio-mcp__start_stop_play
      - mcp__robloxstudio-mcp__run_script_in_play_mode
      - mcp__robloxstudio-mcp__get_studio_mode
    instruction: verify-studio
    rules:
      - condition: Studio verification passed, no runtime errors
        next: reviewers
      - condition: Studio verification failed, runtime errors or incorrect behavior
        next: fix
      - condition: Studio not available, skip verification
        next: reviewers
    output_contracts:
      report:
        - name: 02-studio-verification.md
          format: supervisor-validation

  - name: reviewers
    parallel:
      - name: roblox_review
        edit: false
        persona: roblox-reviewer
        policy:
          - review
          - roblox-coding
        knowledge:
          - roblox-ts
          - flamework
          - studio-mcp
        allowed_tools:
          - Read
          - Glob
          - Grep
          - WebSearch
          - WebFetch
          - mcp__robloxstudio-mcp__run_code
          - mcp__robloxstudio-mcp__get_console_output
          - mcp__robloxstudio-mcp__get_studio_mode
          - mcp__roblox-docs__roblox_search
          - mcp__roblox-docs__roblox_get_class
        instruction: review-arch
        rules:
          - condition: No architecture issues
          - condition: Architecture issues found
        output_contracts:
          report:
            - name: 03-roblox-review.md
              format: architecture-review
      - name: supervise
        edit: false
        persona: supervisor
        policy: review
        knowledge:
          - roblox-ts
          - studio-mcp
        allowed_tools:
          - Read
          - Glob
          - Grep
          - Bash
          - WebSearch
          - WebFetch
          - mcp__robloxstudio-mcp__get_console_output
          - mcp__robloxstudio-mcp__get_studio_mode
        instruction: supervise
        rules:
          - condition: All checks passed
          - condition: Requirements unmet, tests failing
        output_contracts:
          report:
            - name: supervisor-validation.md
              format: supervisor-validation
            - name: summary.md
              format: summary
              use_judge: false
    rules:
      - condition: all("No architecture issues", "All checks passed")
        next: COMPLETE
      - condition: any("Architecture issues found", "Requirements unmet, tests failing")
        next: fix

  - name: fix
    edit: true
    persona: roblox-coder
    policy:
      - roblox-coding
      - coding
    knowledge:
      - roblox-ts
      - flamework
      - studio-mcp
    allowed_tools:
      - Read
      - Glob
      - Grep
      - Edit
      - Write
      - Bash
      - WebSearch
      - WebFetch
      - mcp__robloxstudio-mcp__run_code
      - mcp__robloxstudio-mcp__get_console_output
      - mcp__robloxstudio-mcp__get_studio_mode
      - mcp__roblox-docs__roblox_search
      - mcp__roblox-docs__roblox_get_class
    required_permission_mode: edit
    pass_previous_response: false
    rules:
      - condition: Issues fixed
        next: verify
      - condition: Cannot proceed, insufficient info
        next: implement
    instruction: fix
